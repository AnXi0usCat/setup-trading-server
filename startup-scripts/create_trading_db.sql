-- create a new database
CREATE DATABASE tradingserver;

BEGIN;

-- try to connect to the new database
\c tradingserver

-- create a role with connect privileges to the warehouse
CREATE ROLE green NOLOGIN;

-- create a new operational role
CREATE ROLE anonymous LOGIN NOSUPERUSER NOCREATEDB NOCREATEROLE PASSWORD 'xwert5gtyut8jh6ui897iujuk';

-- grant green to anonymous
GRANT green TO anonymous;

-- revoke connections from public to the database
REVOKE ALL ON DATABASE tradingserver FROM public;

-- grant connect priveleges to green
GRANT CONNECT ON DATABASE tradingserver to green;

-- revoke all permisisons from public schema
REVOKE ALL ON SCHEMA public FROM public;

-- grant access on scehema public
GRANT USAGE ON SCHEMA public to green;

-- table that will contain all currency pair ID's
CREATE TABLE pair (
id          INTEGER         NOT NULL       GENERATED ALWAYS AS IDENTITY,
name        TEXT            NOT NULL,
tradable    BOOLEAN         NOT NULL       DEFAULT FALSE,
CONSTRAINT pk_pair PRIMARY KEY (id)
);

-- insert all avaialble currency pairs
INSERT INTO pair (name, tradable) VALUES 
('BTCUSDT', TRUE),
('ETHUSDT', TRUE),
('BNBUSDT', TRUE),
('BCCUSDT', TRUE),
('NEOUSDT', TRUE),
('LTCUSDT', TRUE),
('QTUMUSDT', TRUE),
('ADAUSDT', TRUE),
('XRPUSDT', TRUE),
('EOSUSDT', TRUE),
('TUSDUSDT', TRUE),
('IOTAUSDT', TRUE),
('XLMUSDT', TRUE),
('ONTUSDT', TRUE),
('TRXUSDT', TRUE),
('ETCUSDT', TRUE),
('ICXUSDT', TRUE),
('VENUSDT', TRUE),
('NULSUSDT', TRUE),
('VETUSDT', TRUE),
('PAXUSDT', TRUE),
('BCHABCUSDT', TRUE),
('BCHSVUSDT', TRUE),
('USDCUSDT', TRUE),
('LINKUSDT', TRUE),
('WAVESUSDT', TRUE),
('BTTUSDT', TRUE),
('USDSUSDT', TRUE),
('ONGUSDT', TRUE),
('HOTUSDT', TRUE),
('ZILUSDT', TRUE),
('ZRXUSDT', TRUE),
('FETUSDT', TRUE),
('BATUSDT', TRUE),
('XMRUSDT', TRUE),
('ZECUSDT', TRUE),
('IOSTUSDT', TRUE),
('CELRUSDT', TRUE),
('DASHUSDT', TRUE),
('NANOUSDT', TRUE),
('OMGUSDT', TRUE),
('THETAUSDT', TRUE),
('ENJUSDT', TRUE),
('MITHUSDT', TRUE),
('MATICUSDT', TRUE),
('ATOMUSDT', TRUE),
('TFUELUSDT', TRUE),
('ONEUSDT', TRUE),
('FTMUSDT', TRUE),
('ALGOUSDT', TRUE),
('USDSBUSDT', TRUE),
('GTOUSDT', TRUE),
('ERDUSDT', TRUE),
('DOGEUSDT', TRUE),
('DUSKUSDT', TRUE),
('ANKRUSDT', TRUE),
('WINUSDT', TRUE),
('COSUSDT', TRUE),
('NPXSUSDT', TRUE),
('COCOSUSDT', TRUE),
('MTLUSDT', TRUE),
('TOMOUSDT', TRUE),
('PERLUSDT', TRUE),
('DENTUSDT', TRUE),
('MFTUSDT', TRUE),
('KEYUSDT', TRUE),
('STORMUSDT', TRUE),
('DOCKUSDT', TRUE),
('WANUSDT', TRUE),
('FUNUSDT', TRUE),
('CVCUSDT', TRUE),
('CHZUSDT', TRUE),
('BANDUSDT', TRUE),
('BUSDUSDT', TRUE),
('BEAMUSDT', TRUE),
('XTZUSDT', TRUE),
('RENUSDT', TRUE),
('RVNUSDT', TRUE),
('HCUSDT', TRUE),
('HBARUSDT', TRUE),
('NKNUSDT', TRUE),
('STXUSDT', TRUE),
('KAVAUSDT', TRUE),
('ARPAUSDT', TRUE),
('IOTXUSDT', TRUE),
('RLCUSDT', TRUE),
('MCOUSDT', TRUE),
('CTXCUSDT', TRUE),
('BCHUSDT', TRUE),
('TROYUSDT', TRUE),
('VITEUSDT', TRUE),
('FTTUSDT', TRUE),
('EURUSDT', TRUE),
('OGNUSDT', TRUE),
('DREPUSDT', TRUE),
('BULLUSDT', TRUE),
('BEARUSDT', TRUE),
('ETHBULLUSDT', TRUE),
('ETHBEARUSDT', TRUE),
('TCTUSDT', TRUE),
('WRXUSDT', TRUE),
('BTSUSDT', TRUE),
('LSKUSDT', FALSE),
('BNTUSDT', FALSE),
('LTOUSDT', FALSE),
('EOSBULLUSDT', FALSE),
('EOSBEARUSDT', FALSE),
('XRPBULLUSDT', FALSE),
('XRPBEARUSDT', FALSE),
('STRATUSDT', FALSE),
('AIONUSDT', FALSE),
('MBLUSDT', FALSE),
('COTIUSDT', FALSE),
('BNBBULLUSDT', FALSE),
('BNBBEARUSDT', FALSE),
('STPTUSDT', FALSE),
('WTCUSDT', FALSE),
('DATAUSDT', FALSE),
('XZCUSDT', FALSE),
('SOLUSDT', FALSE),
('CTSIUSDT', FALSE),
('HIVEUSDT', FALSE),
('CHRUSDT', FALSE),
('BTCUPUSDT', FALSE),
('BTCDOWNUSDT', FALSE),
('GXSUSDT', FALSE),
('ARDRUSDT', FALSE),
('LENDUSDT', FALSE),
('MDTUSDT', FALSE),
('STMXUSDT', FALSE),
('KNCUSDT', FALSE),
('REPUSDT', FALSE),
('LRCUSDT', FALSE),
('PNTUSDT', FALSE),
('COMPUSDT', FALSE),
('BKRWUSDT', FALSE),
('SCUSDT', FALSE),
('ZENUSDT', FALSE),
('SNXUSDT', FALSE),
('ETHUPUSDT', FALSE),
('ETHDOWNUSDT', FALSE),
('ADAUPUSDT', FALSE),
('ADADOWNUSDT', FALSE),
('LINKUPUSDT', FALSE),
('LINKDOWNUSDT', FALSE),
('VTHOUSDT', FALSE),
('DGBUSDT', FALSE),
('GBPUSDT', FALSE),
('SXPUSDT', FALSE),
('MKRUSDT', FALSE),
('DAIUSDT', FALSE),
('DCRUSDT', FALSE),
('STORJUSDT', FALSE),
('BNBUPUSDT', FALSE),
('BNBDOWNUSDT', FALSE),
('XTZUPUSDT', FALSE),
('XTZDOWNUSDT', FALSE),
('MANAUSDT', FALSE),
('AUDUSDT', FALSE),
('YFIUSDT', FALSE),
('BALUSDT', FALSE),
('BLZUSDT', FALSE),
('IRISUSDT', FALSE),
('KMDUSDT', FALSE),
('JSTUSDT', FALSE),
('SRMUSDT', FALSE),
('ANTUSDT', FALSE),
('CRVUSDT', FALSE),
('SANDUSDT', FALSE),
('OCEANUSDT', FALSE),
('NMRUSDT', FALSE),
('DOTUSDT', FALSE),
('LUNAUSDT', FALSE),
('RSRUSDT', FALSE),
('PAXGUSDT', FALSE),
('WNXMUSDT', FALSE),
('TRBUSDT', FALSE),
('BZRXUSDT', FALSE),
('SUSHIUSDT', FALSE),
('YFIIUSDT', FALSE),
('KSMUSDT', FALSE),
('EGLDUSDT', FALSE),
('DIAUSDT', FALSE),
('RUNEUSDT', FALSE),
('FIOUSDT', FALSE),
('UMAUSDT', FALSE),
('EOSUPUSDT', FALSE),
('EOSDOWNUSDT', FALSE),
('TRXUPUSDT', FALSE),
('TRXDOWNUSDT', FALSE),
('XRPUPUSDT', FALSE),
('XRPDOWNUSDT', FALSE),
('DOTUPUSDT', FALSE),
('DOTDOWNUSDT', FALSE),
('BELUSDT', FALSE),
('WINGUSDT', FALSE),
('LTCUPUSDT', FALSE),
('LTCDOWNUSDT', FALSE),
('UNIUSDT', FALSE),
('NBSUSDT', FALSE),
('OXTUSDT', FALSE),
('SUNUSDT', FALSE),
('AVAXUSDT', FALSE),
('HNTUSDT', FALSE),
('FLMUSDT', FALSE),
('UNIUPUSDT', FALSE),
('UNIDOWNUSDT', FALSE),
('ORNUSDT', FALSE),
('UTKUSDT', FALSE),
('XVSUSDT', FALSE),
('ALPHAUSDT', FALSE),
('AAVEUSDT', FALSE),
('NEARUSDT', FALSE),
('SXPUPUSDT', FALSE),
('SXPDOWNUSDT', FALSE),
('FILUSDT', FALSE),
('FILUPUSDT', FALSE),
('FILDOWNUSDT', FALSE),
('YFIUPUSDT', FALSE),
('YFIDOWNUSDT', FALSE),
('INJUSDT', FALSE),
('AUDIOUSDT', FALSE),
('CTKUSDT', FALSE),
('BCHUPUSDT', FALSE),
('BCHDOWNUSDT', FALSE),
('AKROUSDT', FALSE),
('AXSUSDT', FALSE),
('HARDUSDT', FALSE),
('DNTUSDT', FALSE),
('STRAXUSDT', FALSE),
('UNFIUSDT', FALSE),
('ROSEUSDT', FALSE),
('AVAUSDT', FALSE),
('XEMUSDT', FALSE),
('AAVEUPUSDT', FALSE),
('AAVEDOWNUSDT', FALSE),
('SKLUSDT', FALSE),
('SUSDUSDT', FALSE),
('SUSHIUPUSDT', FALSE),
('SUSHIDOWNUSDT', FALSE),
('XLMUPUSDT', FALSE),
('XLMDOWNUSDT', FALSE),
('GRTUSDT', FALSE),
('JUVUSDT', FALSE),
('PSGUSDT', FALSE),
('1INCHUSDT', FALSE),
('REEFUSDT', FALSE),
('OGUSDT', FALSE),
('ATMUSDT', FALSE),
('ASRUSDT', FALSE),
('CELOUSDT', FALSE),
('RIFUSDT', FALSE),
('BTCSTUSDT', FALSE),
('TRUUSDT', FALSE),
('CKBUSDT', FALSE),
('TWTUSDT', FALSE),
('FIROUSDT', FALSE),
('LITUSDT', FALSE),
('SFPUSDT', FALSE),
('DODOUSDT', FALSE),
('CAKEUSDT', FALSE),
('ACMUSDT', FALSE),
('BADGERUSDT', FALSE),
('FISUSDT', FALSE),
('OMUSDT', FALSE),
('PONDUSDT', FALSE),
('DEGOUSDT', FALSE),
('ALICEUSDT', FALSE),
('LINAUSDT', FALSE),
('PERPUSDT', FALSE),
('RAMPUSDT', FALSE),
('SUPERUSDT', FALSE),
('CFXUSDT', FALSE),
('EPSUSDT', FALSE),
('AUTOUSDT', FALSE),
('TKOUSDT', FALSE),
('PUNDIXUSDT', FALSE),
('TLMUSDT', FALSE),
('1INCHUPUSDT', FALSE),
('1INCHDOWNUSDT', FALSE),
('BTGUSDT', FALSE),
('MIRUSDT', FALSE),
('BARUSDT', FALSE),
('FORTHUSDT', FALSE),
('BAKEUSDT', FALSE),
('BURGERUSDT', FALSE),
('SLPUSDT', FALSE),
('SHIBUSDT', FALSE),
('ICPUSDT', FALSE),
('ARUSDT', FALSE),
('POLSUSDT', FALSE),
('MDXUSDT', FALSE),
('MASKUSDT', FALSE),
('LPTUSDT', FALSE),
('NUUSDT', FALSE),
('XVGUSDT', FALSE),
('ATAUSDT', FALSE),
('GTCUSDT', FALSE),
('TORNUSDT', FALSE),
('KEEPUSDT', FALSE),
('ERNUSDT', FALSE),
('KLAYUSDT', FALSE),
('PHAUSDT', FALSE),
('BONDUSDT', FALSE),
('MLNUSDT', FALSE);
 
------------------
-- public.order --
------------------ยง
CREATE TABLE "order" (
id                          BIGINT GENERATED ALWAYS AS IDENTITY     NOT NULL,
symbol                      TEXT                                    NOT NULL,
order_id                    BIGINT                                 NOT NULL,
order_list_id               INTEGER                                 NOT NULL,
client_order_id             TEXT                                    NOT NULL,
transaction_time            NUMERIC                                 NOT NULL,
price                       NUMERIC                                 NOT NULL,
orig_qty                    NUMERIC                                 NOT NULL,
executed_qty                NUMERIC                                 NOT NULL,
cummulative_quote_qty       NUMERIC                                 NOT NULL,
status                      TEXT                                    NOT NULL,
time_in_force               TEXT                                    NOT NULL,
type                        TEXT                                    NOT NULL,
side                        TEXT                                    NOT NULL,
filled_price                NUMERIC                                 NOT NULL,
filled_qty                  NUMERIC                                 NOT NULL,
commission                  NUMERIC                                 NOT NULL,
commission_asset            TEXT                                    NOT NULL,
CONSTRAINT pk_order PRIMARY KEY (id)
);

CREATE INDEX idx_order_1 ON "order" (transaction_time);
CREATE INDEX idx_order_2 ON "order" (symbol);

-----------------------
-- public.open_order --
-----------------------
CREATE TABLE open_order (
id                          INTEGER GENERATED ALWAYS AS IDENTITY    NOT NULL,
symbol                      TEXT                                    NOT NULL,
side                        TEXT                                    NOT NULL,
executed_qty                NUMERIC                                 NOT NULL,
transaction_time            TIMESTAMP WITHOUT TIME ZONE             NOT NULL,
num_updates                 INTEGER                                 NOT NULL        DEFAULT 0,
CONSTRAINT pk_open_order PRIMARY KEY (id)
);


-- grant privileges to green
GRANT SELECT, INSERT, UPDATE, DELETE ON pair, "order", open_order to green;

COMMIT;
